<!DOCTYPE html>
<html class="h-100">
<head>

    <title>Exhaust Timer Experiment</title>

    <!-- mobile meta tags-->
    <meta name="viewport" content="width=device-width"/>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <!-- pwa manifest -->
    <link rel="manifest" href="manifest.json" crossorigin="use-credentials"/>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/widgets.css">
    <link rel="stylesheet" href="css/skin.css">

</head>
<body class="skin-body h-100" data-view-group="mode" data-view-states="">

  <section data-view-group="screens" data-view-states="main">
    
    <!-- # main screen -->
    <section data-view-group="screens" data-view-name="main">
    [ .container-1rem

      <!-- navigation -->
      [ .d-flex .justify-content-end
        [
          [btn 'Settings' .skin-btn-default data-onclick="navigate" data-target="settings"]
          [ .void .void-1x]
        ]
      ]

      <!-- # version -->
      [ .d-flex .justify-content-end
        [small 'v1.2x']
      ]
      [ .void .void-1x]

      <!-- # ratio slider -->
      [
        Work / rest ratio : 
        [s ._txtWorkRestRatio]
        [
          [in type="range" step="0.01" min="0.05" max="0.6" ._inWorkRestRatio data-oninput="update-ratio" .w-100]
        ]
        [ ._txtInfoRatioConfig .d-flex .gap-quarter .flex-column
          [
            Work duration: [s ._Work]
            [btn 'Edit' data-onclick="set-limit" .skin-btn-default]
          ]
          [
            Break duration: [s ._Break]
            [btn 'Edit' data-onclick="set-break" .skin-btn-default .obsoletes]
          ]
        ]
        [ .void .void-half]
        [ .d-flex .justify-content-end
          [btn 'Apply' data-onclick="apply-ratio" .skin-btn-default]
        ]
      ]
      [ .void .void-2x]
      [hr]
      [ .void .void-2x]

      <!-- # instant recovery -->
      [ .d-flex .gap-half .justify-content-end
        [
          [btn 'Instant Recovery' data-onclick="instant-recovery" .skin-btn-default]
        ]
        [btn 'Fake screen off' onclick="ui.RemindMe()" .skin-btn-default]
      ]
      [ .void .void-2x]

      [ {ta:center} .wg-Time
        
        [ 
          [s .inner
            [s ._txt .time]
            [s '/' .limit]
            [s '' .limit ._limit]
          ]
        ]
        [ .void .void-full]

        [ data-view-group="timerState" data-view-states="idle"
      
          <!-- # timer info -->
          [
            [s '---' ._txtTimer]
          ]
          [ .void .void-full]

          <!-- # timer actions -->
          [ data-view-group="timerState" data-view-name="idle started"
            [ .d-flex .gap-half .flex-wrap .justify-content-center  .align-items-center
              [ data-view-group="timerState" data-view-name="idle"
                [btn 'Start' onclick="ui.Start()"  .skin-btn-default]
              ]
              [ data-view-group="timerState" data-view-name="started"
                [btn 'Pause' onclick="ui.Stop()" .skin-btn-danger]
              ]
              |
              [ data-view-group="timerState" data-view-name="idle started"
                [ .d-flex .gap-half .justify-content-center
                  [btn 'Take a rest' onclick="ui.TakeRest()" .skin-btn-danger]
                  [btn 'Custom' onclick="ui.TakeCustomRest()" .skin-btn-danger]
                ]   
              ]
            ]
          ]
          [ data-view-group="timerState" data-view-name="recovery"
            [btn 'Stop' onclick="ui.StopRest()" .skin-btn-danger]
          ]
          [ .void .void-2x]

          <!-- # rest time -->
          [ .d-flex .flex-column .gap-half .align-items-ccenter
            [ 
              Rest time: [s ._txtEstRestTime]
            ]
          ]
          [ .void .void-1x]

          <!-- # suggestion -->
          [ .text-align-start
            [
              [small 'Recent custom rest time :']
            ]
            [ .void .void-half]
            [ ._listBreakSuggestion .wg-BreakSuggestion data-onclick="handle-click-recent-rest"]
          ]

          <!-- # recovery, # restore -->
          [ data-view-group="timerState" data-view-name="recovery"
            [
              [small ._txtRestoreTime]
            ]
          ]

          [ ._listRestTimeSuggestion .wg-RestTimeSuggest]

        ]

      ]
          
    ]
    </section>

    <!-- # settings screen -->
    <section data-view-group="screens" data-view-name="settings">
    [ .container-1rem
      
      <!-- navigation -->
      [
        [ .d-flex .gap-full .align-items-center
          [btn 'Back' .skin-btn-default data-onclick="navigate" data-target="main"]
          [s 'Settings']
        ]
        [ .void .void-1x]
      ]


      <!-- PWA cache manager -->
      [
        [small 'Updates & Offline Access']
      ]
      [ .void .void-half]
      [ {d:flex;gap:0.5rem;flex-wrap:wrap;justify-content:center}
        [btn 'Check for updates' .skin-btn-default onclick="pwaCacher.Cache()"]
        [btn 'Remove app cache' .skin-btn-default onclick="pwaCacher.ClearCache()"]
      ]
      [hr]
      [ .void .void-2x]
    
      [
        [small 'Application data']
      ]
      [ .void .void-half]
      [btn 'Reset data' data-onclick="reset-data" .skin-btn-default]
      [hr]
      [ .void .void-2x]

      <!-- # sound, # alarm -->
      [ .settings-group
        [ 'Alarm Sound' .settings-group-title]
        [ .void .void-half]
        [ .settings-card-inner
          
          [ .d-flex .flex-wrap .gap-half
            [btn 'Set audio' data-onclick="pick-audio" .skin-btn-default]
            [btn 'Remove audio' data-onclick="remove-audio" .skin-btn-default]
            [btn 'Test audio' data-onclick="test-audio" .skin-btn-default]
            [btn 'Stop test' data-onclick="stop-test-audio" .skin-btn-default]
          ]
          [ .void-half]
          
          [ .d-flex .align-items-center .gap-half
            Volume : [in data-jsq="alarm-volume" type="range" min="0.2" max="1" step="0.1" value="1" data-oninput="handle-input-alarm-volume"]
          ]
          
        ]
      ]

    ]
    </section>
    
  </section>

  [ .container-screen-off ._container-screen-off]

  <!-- # templates -->
  <template id="tmp-dialog-alert">
    [dialog .wg-Windog
    <!-- ^# tmp-dialog-alert -->
      [ .backdrop]
      [ .wrapper
        
        <form method="dialog" data-ref="form">
          [ data-kind="message"]
          [ .void .void-full]
          [ .text-center
            [btn 'Ok']
          ]
        </form>
      ]
    ]
  </template>
  <template id="tmp-dialog-prompt">
    [dialog .wg-Windog
    <!-- ^# tmp-dialog-prompt -->
      [ .backdrop]
      [ .wrapper
        
        <form method="dialog" data-ref="form">
          [ data-kind="message"]
          [ .void .void-half]
          
          [in type="text" data-kind="input" .input-style-default]
          [ .void .void-full]
          
          [ .d-flex .justify-content-end .gap-full
            [btn 'Ok' value="ok"]
            [btn 'Cancel']
          ]
        </form>
      ]
    ]
  </template>
  <template id="tmp-dialog-confirm">
    [dialog .wg-Windog
    <!-- ^# tmp-dialog-confirm -->
      [ .backdrop]
      [ .wrapper
      
        <form method="dialog" data-ref="form">
          [ data-kind="message"]
          [ .void .void-full]
          [ .d-flex .justify-content-end .gap-full
            [btn 'OK' value="ok"]
            [btn 'Cancel']
          ]
        </form>
      ]
    ]
  </template>
  <template id="tmp-list-break-suggestion">
    [ data-kind="item" data-id="" .item data-duration=""
      <!-- # tmp suggestion -->
      [s '00:00' ._labelValue .label]
      [ .action data-action="delete"
        [btn 'x']
      ]
    ]
  </template>

  <script src="pwa-cacher.js"></script>
  <script src="index.js" type="module"></script>

    <script>
      if (typeof(navigator) !== 'undefined' && 'serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js').then(function(swo) {
            // success
        }).catch(function(e) {
            console.error('Something went wrong.')
        });
      }
    </script>
  
</body>
</html>